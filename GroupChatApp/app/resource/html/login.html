<!DOCTYPE html>
<html>
<head>
<title>ICS: Login</title>
<script type="text/javascript"
	src="##APPLICATION_CONTEXT##/resource/js/jqsm.js"></script>
<link rel="shortcut icon" type="image/x-icon"
	href="##APPLICATION_CONTEXT##/resource/images/favicon.ico" />
<script type="text/javascript">
	$(function() {
		$(this).bind("contextmenu", function(e) {
			e.preventDefault();
		});
		window.resizeTo(571, 755);
		$('#uname').focus();
		$("#submit-btn").click(function(e) {
			var form = $('#login-form');
			var postData = form.serializeArray();
			var formURL = form.attr("action");
			var type = form.attr("method");
			$.ajax({
				url : formURL,
				type : type,
				data : postData,
				success : function(data, textStatus, jqXHR) {
					var response = JSON.parse(data);
					if (response.success) {
						$('#token').val(response.token);
						redirect();
					} else {
						$('#err-msg').text(response.message);
						$('#uname').focus();
					}
				},
				error : function(jqXHR, textStatus, errorThrown) {
				}
			});
			e.preventDefault();
		});
		$('#clr-btn').click(function() {
			$('#uname').val('');
			$('#pass').val('');
			$('#uname').focus();
		});

		var size = [ window.outerWidth, window.outerHeight ];
		$(window).resize(function() {
			window.resizeTo(size[0], size[1]);
		});
	});

	function redirect() {
		window.history.replaceState({}, '##APPLICATION_CONTEXT##/init',
				'##APPLICATION_CONTEXT##/chat');
		$("#login-form").attr('action', '##APPLICATION_CONTEXT##/chat');
		$("#login-form").submit();
	}
</script>
<style type="text/css">
#login-div {
	width: 40%;
	border: 1px solid;
	margin: 235px auto;
}

#login-div div {
	margin: 3px 5px;
}
</style>
</head>
<body>
	<form action="##APPLICATION_CONTEXT##/login" id="login-form"
		method="post">
		<div id="login-div">
			<div>Chatroom Login:</div>
			<div style="display: inline-block;">
				<input type="text" name="uname" placeholder="Username" id="uname">
			</div>
			<div style="display: inline-block;">
				<input type="password" name="pass" placeholder="Password" id="pass">
			</div>
			<div style="text-align: center;">
				<input type="submit" value="Sign in" id="submit-btn"> <input
					type="button" id="clr-btn" value="Clear">
			</div>
			<div>
				<span style="color: red;" id="err-msg"></span>
			</div>
		</div>
		<input type="hidden" name="token" id="token">
	</form>
</body>
</html>